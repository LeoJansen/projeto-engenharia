// 1. Configuração do Banco de Dados
datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum MovimentacaoTipo {
  ENTRADA
  SAIDA
}

enum MovimentacaoMotivo {
  CADASTRO
  AJUSTE_MANUAL
  VENDA
}

// 2. Lógica de Negócio: Modelos de Dados

// RNF01: Exigir senha pessoal do operador
model Operador {
  id         Int      @id @default(autoincrement())
  nome       String
  login      String   @unique
  senha      String // Em um projeto real, isso seria um hash
  Venda      Venda[]
}

// RF03, RF04: Consultar produto e controlar estoque
model Produto {
  id           Int         @id @default(autoincrement())
  codigoBarras String      @unique
  nome         String
  precoUnitario Decimal    @db.Decimal(10, 2)
  qtdEstoque   Int
  ItemVenda    ItemVenda[]
  Movimentacoes MovimentacaoEstoque[]
}

// RF02, RF05, RF06: Registrar venda, total e pagamento
model Venda {
  id            Int         @id @default(autoincrement())
  dataHora      DateTime    @default(now())
  totalVenda    Decimal     @db.Decimal(10, 2)
  tipoPagamento String // "Dinheiro", "Cartão"
  
  idOperador    Int
  operador      Operador    @relation(fields: [idOperador], references: [id])
  
  itens         ItemVenda[]
  movimentacoes MovimentacaoEstoque[]
}

// RF01: Registrar os produtos (itens) vendidos
model ItemVenda {
  id           Int     @id @default(autoincrement())
  quantidade   Int
  precoMomento Decimal @db.Decimal(10, 2) // Preço no momento da venda
  
  idVenda      Int
  venda        Venda   @relation(fields: [idVenda], references: [id])
  
  idProduto    Int
  produto      Produto @relation(fields: [idProduto], references: [id])
}

model MovimentacaoEstoque {
  id           Int                @id @default(autoincrement())
  criadoEm     DateTime           @default(now())
  tipo         MovimentacaoTipo
  motivo       MovimentacaoMotivo
  quantidade   Int
  produtoId    Int
  vendaId      Int?

  produto      Produto            @relation(fields: [produtoId], references: [id])
  venda        Venda?             @relation(fields: [vendaId], references: [id])

  @@index([criadoEm])
  @@index([tipo])
  @@index([produtoId])
  @@index([vendaId])
}